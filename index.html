<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokemon TCG Pocket Simulator</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .results-section {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        .result-item {
            padding: 8px 0;
            border-bottom: 1px solid #dee2e6;
        }
        .result-item:last-child {
            border-bottom: none;
        }
        #collectionChart {
            height: 500px !important;
            max-height: 500px;
        }
        .loading {
            position: relative;
            min-height: 200px;
        }
        .loading::after {
            content: attr(data-progress);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.2em;
            color: #6c757d;
        }
        .progress {
            display: none;
        }
        .loading .progress {
            display: block;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container py-4">
        <div class="card shadow">
            <div class="card-body">
                <h1 class="card-title text-center mb-4">Pokemon TCG Pocket Simulator</h1>
                
                <ul class="nav nav-tabs mb-4" id="simTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="pack-tab" data-bs-toggle="tab" data-bs-target="#pack" type="button" role="tab" aria-controls="pack" aria-selected="true">Pack Simulator</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="collection-tab" data-bs-toggle="tab" data-bs-target="#collection" type="button" role="tab" aria-controls="collection" aria-selected="false">Collection Simulator</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="specific-tab" data-bs-toggle="tab" data-bs-target="#specific" type="button" role="tab" aria-controls="specific" aria-selected="false">Specific Card</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="gold-tab" data-bs-toggle="tab" data-bs-target="#gold" type="button" role="tab" aria-controls="gold" aria-selected="false">Gold Calculator</button>
                    </li>
                </ul>

                <div class="tab-content" id="simTabsContent">
                    <!-- Pack Simulator Tab -->
                    <div class="tab-pane fade show active" id="pack" role="tabpanel">
                        <div class="row g-3 align-items-end mb-4">
                            <div class="col-md-3">
                                <label for="packType" class="form-label">Pack Type 1</label>
                                <select id="packType" class="form-select">
                                    <!-- Options populated dynamically -->
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="packType2" class="form-label">Pack Type 2 (Optional)</label>
                                <select id="packType2" class="form-select">
                                    <option value="">None</option>
                                    <!-- Options populated dynamically -->
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label for="packCount" class="form-label">Packs per Run</label>
                                <input type="number" id="packCount" class="form-control" min="1" max="1000000" value="1000">
                            </div>
                            <div class="col-md-2">
                                <label for="runCount" class="form-label">Number of Runs</label>
                                <input type="number" id="runCount" class="form-control" min="1" max="10000" value="1">
                            </div>
                            <div class="col-md-2">
                                <label class="form-label">&nbsp;</label>
                                <button id="simulateBtn" class="btn btn-primary w-100">Simulate Packs</button>
                            </div>
                        </div>

                        <div id="error" class="alert alert-danger d-none">
                            Please enter a number between 1 and 1,000,000
                        </div>

                        <div id="results" class="results-section">
                            <h2 class="h4 mb-4">Results</h2>
                            
                            <div class="mb-4">
                                <h3 class="h5 mb-3">Pack Distribution</h3>
                                <div id="packResults"></div>
                            </div>

                            <div class="row">
                                <div class="col-md-6" id="pack1Results">
                                    <h3 class="h5 mb-3">Pack Type 1 Results</h3>
                                    <div class="table-responsive">
                                        <table class="table table-striped table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Rarity</th>
                                                    <th>Cards</th>
                                                    <th>Pulled</th>
                                                    <th>Rate</th>
                                                </tr>
                                            </thead>
                                            <tbody id="cardDistributionTable1"></tbody>
                                            <tfoot>
                                                <tr class="table-secondary">
                                                    <td colspan="2">Total</td>
                                                    <td id="totalCards1"></td>
                                                    <td>100%</td>
                                                </tr>
                                            </tfoot>
                                        </table>
                                    </div>
                                </div>
                                <div class="col-md-6" id="pack2Results" style="display: none;">
                                    <h3 class="h5 mb-3">Pack Type 2 Results</h3>
                                    <div class="table-responsive">
                                        <table class="table table-striped table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Rarity</th>
                                                    <th>Cards</th>
                                                    <th>Pulled</th>
                                                    <th>Rate</th>
                                                </tr>
                                            </thead>
                                            <tbody id="cardDistributionTable2"></tbody>
                                            <tfoot>
                                                <tr class="table-secondary">
                                                    <td colspan="2">Total</td>
                                                    <td id="totalCards2"></td>
                                                    <td>100%</td>
                                                </tr>
                                            </tfoot>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Multi-Run Statistics -->
                            <div class="mt-4" id="multiRunStats" style="display: none;">
                                <h3 class="h5 mb-3">Multi-Run Statistics</h3>
                                <div class="row" id="multiRunStatsContainer">
                                    <div class="col-md-6" id="multiRunStats1">
                                        <h4 class="h6">Pack Type 1 - Rarity Distribution Across All Runs</h4>
                                        <div class="table-responsive">
                                            <table class="table table-striped table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>Rarity</th>
                                                        <th>Avg per Run</th>
                                                        <th>Min per Run</th>
                                                        <th>Max per Run</th>
                                                        <th>Standard Deviation</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="multiRunTable1"></tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="col-md-6" id="multiRunStats2" style="display: none;">
                                        <h4 class="h6">Pack Type 2 - Rarity Distribution Across All Runs</h4>
                                        <div class="table-responsive">
                                            <table class="table table-striped table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>Rarity</th>
                                                        <th>Avg per Run</th>
                                                        <th>Min per Run</th>
                                                        <th>Max per Run</th>
                                                        <th>Standard Deviation</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="multiRunTable2"></tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Collection Simulator Tab -->
                    <div class="tab-pane fade" id="collection" role="tabpanel">
                        <div class="row g-3 align-items-end mb-4">
                            <div class="col-md-4">
                                <label for="collectionPackType1" class="form-label">Pack Type 1</label>
                                <select id="collectionPackType1" class="form-select">
                                    <!-- Options populated dynamically -->
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="collectionPackType2" class="form-label">Pack Type 2 (Optional)</label>
                                <select id="collectionPackType2" class="form-select">
                                    <option value="">None</option>
                                    <!-- Options populated dynamically -->
                                </select>
                            </div>
                            <div class="col-md-4">
                                <button id="simulateCollectionBtn" class="btn btn-primary w-100">Simulate</button>
                            </div>
                        </div>

                        <div class="form-check mb-4">
                            <input class="form-check-input" type="checkbox" id="excludeRareCards">
                            <label class="form-check-label" for="excludeRareCards">
                                Only collect common cards (♢, ♢♢, ♢♢♢, ♢♢♢♢)
                            </label>
                        </div>

                        <div class="form-check mb-4">
                            <input class="form-check-input" type="checkbox" id="doubleCollection">
                            <label class="form-check-label" for="doubleCollection">
                                x2 for all cards (collect each cards twice)
                            </label>
                        </div>

                        <div class="results-section">
                            <h2 class="h4 mb-4">Collection Completion Results (10000 trials)</h2>
                            <div id="chartContainer" style="height: 500px;">
                                <div class="progress">
                                    <div class="progress-bar" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <canvas id="collectionChart"></canvas>
                            </div>
                            <div id="collectionStats" class="mt-4">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h3 class="h5">Pack Type 1 Statistics</h3>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>10th Percentile:</span>
                                            <span id="p10Packs1">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>20th Percentile:</span>
                                            <span id="p20Packs1">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>30th Percentile:</span>
                                            <span id="p30Packs1">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>40th Percentile:</span>
                                            <span id="p40Packs1">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>50th Percentile (Median):</span>
                                            <span id="p50Packs1">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>60th Percentile:</span>
                                            <span id="p60Packs1">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>70th Percentile:</span>
                                            <span id="p70Packs1">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>80th Percentile:</span>
                                            <span id="p80Packs1">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>90th Percentile:</span>
                                            <span id="p90Packs1">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>Average:</span>
                                            <span id="avgPacks1">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>Minimum:</span>
                                            <span id="minPacks1">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>Maximum:</span>
                                            <span id="maxPacks1">-</span>
                                        </div>
                                    </div>
                                    <div class="col-md-6" id="stats2Container" style="display: none;">
                                        <h3 class="h5">Pack Type 2 Statistics</h3>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>10th Percentile:</span>
                                            <span id="p10Packs2">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>20th Percentile:</span>
                                            <span id="p20Packs2">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>30th Percentile:</span>
                                            <span id="p30Packs2">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>40th Percentile:</span>
                                            <span id="p40Packs2">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>50th Percentile (Median):</span>
                                            <span id="p50Packs2">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>60th Percentile:</span>
                                            <span id="p60Packs2">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>70th Percentile:</span>
                                            <span id="p70Packs2">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>80th Percentile:</span>
                                            <span id="p80Packs2">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>90th Percentile:</span>
                                            <span id="p90Packs2">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>Average:</span>
                                            <span id="avgPacks2">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>Minimum:</span>
                                            <span id="minPacks2">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>Maximum:</span>
                                            <span id="maxPacks2">-</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Specific Card Tab -->
                    <div class="tab-pane fade" id="specific" role="tabpanel">
                        <div class="row g-3 align-items-end mb-4">
                            <div class="col-md-6">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label for="specificPackType1" class="form-label">Pack Type 1</label>
                                        <select id="specificPackType1" class="form-select">
                                            <!-- Options populated dynamically -->
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="targetRarity1" class="form-label">Target Rarity 1</label>
                                        <select id="targetRarity1" class="form-select">
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label for="specificPackType2" class="form-label">Pack Type 2 (Optional)</label>
                                        <select id="specificPackType2" class="form-select">
                                            <option value="">None</option>
                                            <!-- Options populated dynamically -->
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="targetRarity2" class="form-label">Target Rarity 2</label>
                                        <select id="targetRarity2" class="form-select" disabled>
                                            <option value="">Select Pack Type 2 first</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="doubleSpecific">
                                    <label class="form-check-label" for="doubleSpecific">
                                        x2 for target cards (collect target card twice)
                                    </label>
                                </div>
                                <button id="simulateSpecificBtn" class="btn btn-primary">Simulate</button>
                            </div>
                        </div>

                        <div class="results-section">
                            <h2 class="h4 mb-4">Packs Needed for Target Cards (10000 trials)</h2>
                            <div id="specificChartContainer" style="height: 500px;">
                                <div class="progress">
                                    <div class="progress-bar" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <canvas id="specificChart"></canvas>
                            </div>
                            <div id="specificStats" class="mt-4">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h3 class="h5">Rarity 1 Statistics</h3>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>10th Percentile:</span>
                                            <span id="p10PacksSpecific1">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>20th Percentile:</span>
                                            <span id="p20PacksSpecific1">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>30th Percentile:</span>
                                            <span id="p30PacksSpecific1">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>40th Percentile:</span>
                                            <span id="p40PacksSpecific1">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>50th Percentile (Median):</span>
                                            <span id="p50PacksSpecific1">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>60th Percentile:</span>
                                            <span id="p60PacksSpecific1">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>70th Percentile:</span>
                                            <span id="p70PacksSpecific1">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>80th Percentile:</span>
                                            <span id="p80PacksSpecific1">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>90th Percentile:</span>
                                            <span id="p90PacksSpecific1">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>Average:</span>
                                            <span id="avgPacksSpecific1">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>Minimum:</span>
                                            <span id="minPacksSpecific1">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>Maximum:</span>
                                            <span id="maxPacksSpecific1">-</span>
                                        </div>
                                    </div>
                                    <div class="col-md-6" id="stats2ContainerSpecific" style="display: none;">
                                        <h3 class="h5">Rarity 2 Statistics</h3>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>10th Percentile:</span>
                                            <span id="p10PacksSpecific2">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>20th Percentile:</span>
                                            <span id="p20PacksSpecific2">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>30th Percentile:</span>
                                            <span id="p30PacksSpecific2">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>40th Percentile:</span>
                                            <span id="p40PacksSpecific2">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>50th Percentile (Median):</span>
                                            <span id="p50PacksSpecific2">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>60th Percentile:</span>
                                            <span id="p60PacksSpecific2">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>70th Percentile:</span>
                                            <span id="p70PacksSpecific2">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>80th Percentile:</span>
                                            <span id="p80PacksSpecific2">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>90th Percentile:</span>
                                            <span id="p90PacksSpecific2">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>Average:</span>
                                            <span id="avgPacksSpecific2">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>Minimum:</span>
                                            <span id="minPacksSpecific2">-</span>
                                        </div>
                                        <div class="result-item d-flex justify-content-between">
                                            <span>Maximum:</span>
                                            <span id="maxPacksSpecific2">-</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Gold Calculator Tab -->
                    <div class="tab-pane fade" id="gold" role="tabpanel">
                        <div class="row g-3 mb-4">
                            <div class="col-md-4">
                                <label for="targetPacks" class="form-label">Number of Packs</label>
                                <input type="number" class="form-control" id="targetPacks" min="1" value="100">
                            </div>
                            <div class="col-md-4">
                                <label for="currency" class="form-label">Currency</label>
                                <select class="form-select" id="currency">
                                    <option value="HKD">HKD (Hong Kong Dollar)</option>
                                    <option value="JPY">JPY (Japanese Yen)</option>
                                    <option value="USD">USD (US Dollar)</option>
                                    <option value="GBP">GBP (British Pound)</option>
                                    <option value="EUR">EUR (Euro)</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">&nbsp;</label>
                                <button id="calculateGoldBtn" class="btn btn-primary w-100">Calculate</button>
                            </div>
                        </div>

                        <div class="results-section">
                            <h2 class="h4 mb-4">Gold Purchase Plans</h2>
                            <div class="row">
                                <!-- Plan A: Suggested Package -->
                                <div class="col-md-6">
                                    <div class="card h-100 border-primary">
                                        <div class="card-header bg-primary text-white">
                                            <h3 class="h5 mb-0">Plan A: Single Package</h3>
                                        </div>
                                        <div class="card-body">
                                            <div class="result-item mb-2">
                                                <strong>Package:</strong>
                                                <span id="planAGold">-</span>
                                            </div>
                                            <div class="result-item mb-2">
                                                <strong>Total Cost:</strong>
                                                <span id="planACost">-</span>
                                            </div>
                                            <div class="result-item mb-2">
                                                <strong>Packs You Get:</strong>
                                                <span id="planAPacks">-</span>
                                            </div>
                                            <div class="result-item mb-2">
                                                <strong>Cost Per Pack:</strong>
                                                <span id="planAPerPack">-</span>
                                            </div>
                                            <div class="result-item text-success">
                                                <strong>Extra Packs:</strong>
                                                <span id="planAExtra">-</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Plan B: Exact Gold -->
                                <div class="col-md-6">
                                    <div class="card h-100">
                                        <div class="card-header bg-secondary text-white">
                                            <h3 class="h5 mb-0">Plan B: Multiple Packages</h3>
                                        </div>
                                        <div class="card-body">
                                            <div class="result-item mb-2">
                                                <strong>Total Gold:</strong>
                                                <span id="planBGold">-</span>
                                            </div>
                                            <div class="result-item mb-2">
                                                <strong>Total Cost:</strong>
                                                <span id="planBCost">-</span>
                                            </div>
                                            <div class="result-item mb-2">
                                                <strong>Packs You Get:</strong>
                                                <span id="planBPacks">-</span>
                                            </div>
                                            <div class="result-item mb-2">
                                                <strong>Cost Per Pack:</strong>
                                                <span id="planBPerPack">-</span>
                                            </div>
                                            <div class="mt-3">
                                                <strong>Required Packages:</strong>
                                                <ul id="planBPurchases" class="list-unstyled mt-2 mb-0">
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery, Bootstrap, and Chart.js -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Main Application -->
    <script type="module" src="./js/app.js"></script>
</body>
</html>
